---
title: "ChrisEscobedo_A4"
author: "Chris"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: html_document
---

```{r, include = F}
knitr::opts_chunk$set(echo = F, warnings = F, message = F)
```

```{r}
library(lehdr)
library(tidyverse)
library(tigris)
library(sf)
library(leaflet)
library(censusapi)
library(raster)
library(mapview)

Sys.setenv(CENSUS_KEY="c7ce771b506b13ca6875d12a179606f8087fa381")
```

## Belle Haven

The analysis centered on Belle Haven, a historically under-resourced neighborhood in Menlo Park. The map below shows the three census block groups that make up the neighborhood and which will be used for the analysis. 

```{r, warning = F}
# Belle Haven CBGs - 	060816117001,	060816117002, 060816117003
bh_boundary <- block_groups("CA", "San Mateo") %>% 
  filter(GEOID %in% c("060816117001",	"060816117002", "060816117003")) 

cbg_pal <- colorNumeric(
  palette = "Purples",
  domain = as.numeric(bh_boundary$GEOID)
)

leaflet() %>% 
  addMapboxTiles(
    style_id = "satellite-streets-v11",
    username = "mapbox",
    options = tileOptions(opacity = 0.8)
  ) %>% 
  addPolygons(
    data = bh_boundary,
    fillColor = "violet",
    color = "purple",
    opacity = 1,
    fillOpacity = .5,
    weight = 2,
    label = ~paste0(
      "CBG: ", 
      GEOID
    ),
    highlightOptions = highlightOptions(
      weight = 4,
      opacity = 5
    )
  ) 
```

## Creating Flood Maps

This analysis uses Data from OCOF on flood risk to Belle Haven, given nine different potential scenarios of sea level rise and storm frequency.

```{r, warning = F}

for(slr in c("000","025","050")){
  
  for(rp in c("001","020","100")){
    
    print(paste0("SLR",slr,"_RP",rp))
    
    path <- paste0("/Volumes/GoogleDrive/Shared drives/SFBI/Data Library/OCOF/san_mateo_flooding_slr", slr, "/flooding/v2.1/county_san_mateo_flddepth_slr", slr, "_w", rp, ".tif")
    
    flood <- raster(path) %>% 
      crop(
        bh_boundary %>% 
          st_transform(26910) %>% 
          st_bbox()
      )
    
    writeRaster(flood, paste0("flood/SLR",slr,"_RP",rp,"_bh_flood.tif"), overwrite = T)
  }
}

SLR000_RP001 <- raster("flood/SLR000_RP001_bh_flood.tif")
SLR000_RP020 <- raster("flood/SLR000_RP020_bh_flood.tif")
SLR000_RP100 <- raster("flood/SLR000_RP100_bh_flood.tif")

SLR025_RP001 <- raster("flood/SLR025_RP001_bh_flood.tif")
SLR025_RP020 <- raster("flood/SLR025_RP020_bh_flood.tif")
SLR025_RP100 <- raster("flood/SLR025_RP100_bh_flood.tif")

SLR050_RP001 <- raster("flood/SLR050_RP001_bh_flood.tif")
SLR050_RP020 <- raster("flood/SLR050_RP020_bh_flood.tif")
SLR050_RP100 <- raster("flood/SLR050_RP100_bh_flood.tif")
```


```{r, warning = F}
flood_pal <- colorNumeric(
  palette = "Blues",
  domain = values(SLR000_RP001),
  na.color = "transparent"
)

leaflet() %>% 
  addMapboxTiles(
    style_id = "satellite-streets-v11",
    username = "mapbox",
    options = tileOptions(opacity = 0.5)
  ) %>% 
  addRasterImage(
    SLR000_RP001,
    colors = flood_pal
  ) %>% 
  addLegend(
    pal = flood_pal,
    values = values(SLR000_RP001),
    title = "Flood depth, cm"
  )
```

