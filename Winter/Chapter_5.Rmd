---
title: "Chapter5"
author: "Chris"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: html_document
---

```{r, include = F}
knitr::opts_chunk$set(echo = F, warnings = F, message = F)
```

```{r}
library(lehdr)
library(tidyverse)
library(tigris)
library(sf)
library(leaflet)
library(censusapi)
library(raster)
library(mapview)
library(mapboxapi)

Sys.setenv(CENSUS_KEY="c7ce771b506b13ca6875d12a179606f8087fa381")
```

```{r, warning + F}
slr <- 25
rp <- 20

path <- paste0("/Volumes/GoogleDrive/Shared drives/SFBI/Data Library/OCOF/san_mateo_flooding_slr",str_pad(slr, 3, "left", "0"), "/flooding/v2.1/county_san_mateo_flddepth_slr", str_pad(slr, 3, "left", "0"), "_w", str_pad(rp, 3, "left", "0"), ".tif")

test_flood <- raster(path)

# Belle Haven CBGs - 060816117002, 060816117003, 060816117001
bh_boundary <- block_groups("CA", "San Mateo") %>% 
  filter(GEOID %in% c("060816117003")) #, "060816117002", "060816117001"))

mapview(bh_boundary)

test_flood_bh <- test_flood %>% 
  crop(
    bh_boundary %>% 
      st_transform(26910) %>% 
      st_bbox()
  )

plot(test_flood_bh)

epa_boundary <- places("CA") %>% 
  filter(NAME == "Menlo Park")

## epa
epa_boundary <- places("CA") %>% 
  filter(NAME == "East Palo Alto")

test_flood_epa <- test_flood %>% 
  crop(
    epa_boundary %>% 
      st_transform(26910) %>% 
      st_bbox()
  )

plot(test_flood_epa)

flood_pal <- colorNumeric(
  palette = "Blues",
  domain = values(test_flood_epa),
  na.color = "transparent"
)

leaflet() %>% 
  addMapboxTiles(
    style_id = "satellite-streets-v11",
    username = "mapbox",
    options = tileOptions(opacity = 0.5)
  ) %>% 
  addRasterImage(
    test_flood_epa,
    colors = flood_pal
  ) %>% 
  addLegend(
    pal = flood_pal,
    values = values(test_flood_epa),
    title = "Flood depth, cm"
  )
```

```{r}
```

