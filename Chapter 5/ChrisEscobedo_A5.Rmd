---
title: "ChrisEscobedo_A5"
author: "Chris"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: html_document
---

```{r, include = F}
knitr::opts_chunk$set(echo = F, warnings = F, message = F)
```

```{r, include = F}
library(tidyverse)
library(sf)
library(leaflet)
library(corrplot)
library(gtools)
library(car)
library(tigris)
library(censusapi)
library(readxl)

Sys.setenv(CENSUS_KEY="c7ce771b506b13ca6875d12a179606f8087fa381")

acs_vars_2019_5yr <-
  listCensusMetadata(
    name = "2019/acs/acs5",
    type = "variables"
  )
```


```{r, include = F}
ces4 <- read_excel("calenviroscreen40resultsdatadictionary_F_2021.xlsx")

ca_tracts <- tracts("CA",c(
    "Alameda",
    "Contra Costa",
    "Marin",
    "Napa",
    "San Francisco",
    "San Mateo",
    "Santa Clara",
    "Solano",
    "Sonoma"), cb = T, progress_bar = F)

ces4_map <- ces4 %>% 
  left_join(
    ca_tracts %>% 
      transmute(GEOID = GEOID %>% as.numeric()),
    by = c("Census Tract" = "GEOID") 
  ) %>% 
  filter(
    !is.na(PM2.5), 
    !is.na(Asthma)
  ) %>% 
  st_as_sf()

```
## Asthma and PM2.5 Concentration Maps

The following maps show the concentration of asthma and PM2.5 prevalence in Bay Area Counties. The data used to create the maps comes from CalEnviroScreen 4.0, released on October 20, 2021. The maps are at the level of Census Tracts.

*(I had to narrow my scope to only Bay Area Counties rather than conduct a statewide analysis because otherwise my computer would not knit the file and allow me to upload it to Github.)*

#### Asthma Data
The data for the map showing the prevalence of Asthma is the rate of Emergency Department visits for asthma per 10,000 people per year, averaged over 2015-2017. Thus, the data is only up to date until 2017 and may reflect numbers that are no longer accurate. 

```{r, warning = F}
Asthma_pal <- colorNumeric(
  palette = "Purples",
  domain = ces4_map$Asthma
)

leaflet() %>%
  addTiles() %>% 
  addPolygons(
    data =ces4_map,
    fillColor = ~Asthma_pal(Asthma),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.8,
    weight = 1,
    label = ~paste0(
      round(Asthma), 
      " ED visits for Asthma per year per 10,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ces4_map,
    pal = Asthma_pal,
    values = ~Asthma,
    title = "ED visits for Asthma<br>per year per 10,000,<br>averaged over 2015-2017"
  )
```
#### PM2.5 Data
The PM2.5 map contains data on the fine particle pollution throughout the state. The data represents the annual mean concentration of PM2.5 (the weighted average of measured monitor concentrations and satellite observations, µg/m3), over three years, from 2015 to 2017. Thus, the data may also only be accurate up until 2017 and may be outdated. 

```{r, warning = F}
PM_pal <- colorNumeric(
  palette = "Purples",
  domain = ces4_map$PM2.5
)

leaflet() %>%
  addTiles() %>% 
  addPolygons(
    data =ces4_map,
    fillColor = ~PM_pal(PM2.5),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.8,
    weight = .5,
    label = ~paste0(
      PM2.5, 
      " µg/m3 of PM2.5 on average per year"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ces4_map,
    pal = PM_pal,
    values = ~PM2.5,
    title = "Annual mean concentration<br>of PM2.5 (µg/m3)<br>averaged over 2015-2017"
  )
```
#### Discusssion of Maps
Both maps show disproportionately high prevalence of Asthma and PM2.5 certain urban areas, in particular in the East Bay and in the Eastern part of the Bay Area counties. However, an interesting thing to note is that although it seemed PM2.5 levels were high throughout many urban areas, Asthma levels were not always distributed in the same way. Overall, the levels of prevalence did seem to be at least slightly correlated at first glance, so I will see if this assumption is correct with a more rigorous examination.

## Asthma and PM2.5 Scatter Plot
Below is a scatter plot with PM2.5 on the x-axis and Asthma on the y-axis, with a best-fit line.

```{r}
ggplot(
  data = ces4_map,
  aes(
      x = PM2.5,
      y = Asthma
    )
) +
  geom_point() +
  geom_smooth(method = "lm")
```
The line does not appear to fit the data well, since the data is not normally distributed. It seems as though points is clustered in the bottom center of the plot, but since there are some very high levels of asthma, the distribution is off. The best fit line currently shows a slight positive correlation.


```{r}
model <- lm(Asthma ~ PM2.5, ces4_map)

summary(model)
```
#### Discussion
The best fit line does not represent the data well. The median residual is not centerd around zero, is not very close to zero, and does not have symmetrical distribution. 








