---
title: "Final"
author: "Chris"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: html_document
---

```{r, include = F}
knitr::opts_chunk$set(echo = F, warnings = F, message = F)
```

```{r}
library(tidyverse)
library(mapview)
library(sf)
library(StatMatch)
library(leaflet)
library(tigris)
library(censusapi)

Sys.setenv(CENSUS_KEY="c7ce771b506b13ca6875d12a179606f8087fa381")
```

tracts
```{r}
bay_county_names <-
  c(
    "Alameda",
    "Contra Costa",
    "Marin",
    "Napa",
    "San Francisco",
    "San Mateo",
    "Santa Clara",
    "Solano",
    "Sonoma"
  )

bay_tracts <- tracts("CA", bay_county_names[1:9], cb = T, progress_bar = F) 

urban_cities <- 
  places("CA", cb = T, progress_bar = FALSE) %>% 
  filter(NAME %in% c("Oakland", "San Francisco", "San Jose","Fremont", "Santa Rosa", "Hayward", "Sunnyvale", "Santa Clara", "Vallejo", "Concord", "Berkeley"))

bay_city_tracts <-
  bay_tracts %>% 
  st_centroid() %>% 
  .[urban_cities, ] %>% 
  st_drop_geometry() %>% 
  left_join(bay_tracts %>% select(GEOID)) %>% 
  st_as_sf()

mapview(bay_city_tracts)

bay_tract_race_income <- 
  getCensus(
    name = "acs/acs5",
    vintage = 2019,
    region = "tract:*",
    regionin = "state:06+county:001,013,041,055,075,081,085,095,097",
    vars = c(
      "B19001_001E",
      "B19001_014E",
      "B19001_015E",
      "B19001_016E",
      "B19001_017E",
      "B19001A_001E"
    )
  ) %>% 
  transmute(
    tract = paste0(state, county, tract),
    perc_over100k = (B19001_014E + B19001_015E + B19001_016E + B19001_017E) / B19001_001E,
    perc_white = B19001A_001E / B19001_001E
  ) %>% 
  filter(
    !is.na(perc_over100k),
    !is.na(perc_white)
  ) %>% 
  left_join(
    bay_city_tracts %>% 
      select(GEOID),
    by = c("tract" = "GEOID"),
  ) %>% 
  st_as_sf()

bay_counties <- counties("CA", cb = T, progress_bar = F) %>% 
  filter(NAME %in% bay_county_names)

mapview(bay_tract_race_income)

## add counts of grocery stores and fast foods for buffers

```

## Census Tract Maps of 11 Most Populated Cities in the Bay Area

Below are three maps showing the census tracts for the 11 most populated cities in the Bay Area. These are the census tracts that will be used for the regression analysis to test correlation between access to healthy food, race, and income.

Note: It is important to note the assumptions that were made to create these maps, and the potential issues with them. First, only the top most populated cities were chosen, perhaps leaving out valuable information from other cities. This was done to minimize the distortion that may have occured from applying the same spatial analysis technique in an urban area and a rural area to determine access to healthy food. 

```{r}

```





