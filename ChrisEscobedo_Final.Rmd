---
title: "Final Assignment"
author: "Chris Escobedo"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: html_document  
---

```{r, include = F}
knitr::opts_chunk$set(echo = F, warnings = F, message = F)
```

```{r}
library(tidyverse)
library(mapview)
library(sf)
library(StatMatch)
library(leaflet)
library(tigris)
library(censusapi)

Sys.setenv(CENSUS_KEY="c7ce771b506b13ca6875d12a179606f8087fa381")
```

```{r, warning = F}
bay_county_names <-
  c(
    "Alameda",
    "Contra Costa",
    "Marin",
    "Napa",
    "San Francisco",
    "San Mateo",
    "Santa Clara",
    "Solano",
    "Sonoma"
  )

bay_tracts <- tracts("CA", bay_county_names[1:9], cb = T, progress_bar = F) 

urban_cities <- 
  places("CA", cb = T, progress_bar = FALSE) %>% 
  filter(NAME %in% c("Oakland", "San Francisco", "San Jose","Fremont", "Santa Rosa", "Hayward", "Sunnyvale", "Santa Clara", "Vallejo", "Concord", "Berkeley"))

bay_city_tracts <-
  bay_tracts %>% 
  st_centroid() %>% 
  .[urban_cities, ] %>% 
  st_drop_geometry() %>% 
  left_join(bay_tracts %>% select(GEOID)) %>% 
  st_as_sf()

bay_tract_race_income <- 
  getCensus(
    name = "acs/acs5",
    vintage = 2019,
    region = "tract:*",
    regionin = "state:06+county:001,013,041,055,075,081,085,095,097",
    vars = c(
      "B19001_001E",
      "B19001_014E",
      "B19001_015E",
      "B19001_016E",
      "B19001_017E",
      "B19001A_001E"
    )
  ) %>% 
  transmute(
    tract = paste0(state, county, tract),
    perc_over100k = (B19001_014E + B19001_015E + B19001_016E + B19001_017E) / B19001_001E,
    perc_white = B19001A_001E / B19001_001E
  ) %>% 
  filter(
    !is.na(perc_over100k),
    !is.na(perc_white)
  ) %>% 
  left_join(
    bay_city_tracts %>% 
      select(GEOID),
    by = c("tract" = "GEOID"),
  ) %>% 
  st_as_sf()


## add counts of grocery stores and fast foods for buffers

```

### Census Tract Maps of 11 Most Populated Cities in the Bay Area

Below are three maps showing the census tracts for the 11 most populated cities in the Bay Area. These are the census tracts that will be used for the regression analysis to test correlation between access to healthy food, race, and income.

*Disclaimer*: It is important to note the assumptions that were made to create these maps, and the potential issues with them. Each map will also include its own set of disclaimers that must be made about each piece of data.

* Only the top most populated cities were chosen, perhaps leaving out valuable information from other cities. This was done to minimize the distortion that may have occurred from applying the same spatial analysis technique in an urban area and a rural area to determine access to healthy food. The number 11 was chosen arbitrarily.
* The census tracts were joined to the spatial locations of the cities using the "centroid" of the census tract, thus some census tracts that were within the boundary of the city in some way may have been left out of the analysis if the center was not within it.


#### Race

The Map Below shows the percentage of the population that is white for each census tract.

```{r}

```

*Disclaimer*

* Since ethnicity is a separate question than race for the Census, any of the races may include the latinx population.

#### Income

The map below shows the percentage of each census tracts that have an annual household income that is above $100k USD. 

```{r}

```

*Disclaimer*

* The decision to use 100k as the cutoff for higher income was a subjective choice chosen to be most representative of median income for the bay area. This number could have been different and the median income is certainly different for every census tract and representative of a different reality for different sized households.

#### Access to Healthy Food

The map below shows the number of grocery stores within a half mile radius from the center of the census tract.

```{r}

```

*Disclaimer*

* The distance of a half mile radius from the center of the census tract was chosen to align with the accessibility metric defined in a 2008 study by the California Center for Public Health Advocacy and the UCLA Center for Health Policy Research. This analysis could have used a different length as an accessibility metric and the results would change.

* The center of the census tract was chosen as the focal point because total count would not be easy to compare, as all census tracts have various shapes and areas. This assumes that the center of the census tract should give a accurate representation of the entire census tract, which may not be true for some areas.

#### Access to Unhealthy Food 

The map below shows the number of fast food restaurants within a five mile radius from the center of the census tract.

```{r}

```

*Disclaimer*

* This analysis assumes that fast food restaurants are providing unhealthy food, which is not always true.

* Same disclaimers as above for spatial assumptions and choices.






